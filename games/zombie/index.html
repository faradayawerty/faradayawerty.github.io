<html>

<head>
	<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
	<title>faw_zombie</title>
	<link rel="icon" href="icon.png">
	<style>
		* {
			margin-top: 0px; 
			margin-bottom: 0px; 
			margin-left: 0px; 
			margin-right: 0px;
			padding: 0;
			touch-action: none;
		}
		body {
			background-color: gray;
			overscroll-behavior: contain;
		}
		#canvas {
			position: absolute;
			width: 100%;
			height: 100%;
			border: 0px solid;
			display: block;
			image-rendering: pixelated;
		}
	</style>
</head>

<body>
	<canvas id="canvas" width=1600 height=1200 style="background-color: #dddddd; border-color: #aaaaaa;"></canvas>
	<script type="text/javascript" src="input.js"></script>
	<script>
		let cvs = document.getElementById("canvas");
		let ctx = canvas.getContext("2d");
		let input = getInput();

		function drawText(ctx, x, y, text) {
			  ctx.font="14px verdana";
			  ctx.fillStyle = 'black';
			  ctx.fillText(text, x, y);
			  ctx.fillStyle = 'white';
			  ctx.fillText(text, x + 1, y + 1);
		}

		function drawCircle(ctx, x, y, r, fill_color, stroke_color) {
			ctx.beginPath();
			ctx.arc(x, y, r, 0, 2 * Math.PI, false);
			ctx.fillStyle = fill_color;
			ctx.fill();
			ctx.lineWidth = 1;
			ctx.strokeStyle = stroke_color;
			ctx.stroke();
		}

		function animate(lastUpdateTime) {
			ctx.clearRect(0, 0, cvs.width, cvs.height);
			ctx.canvas.width  = window.innerWidth;
			ctx.canvas.height = window.innerHeight;

			let w = ctx.canvas.width;
			let h = ctx.canvas.height;
			let left_joystick_x = w / 4;
			let left_joystick_y = 5 * h / 6;
			let right_joystick_x = 3 * w / 4;
			let right_joystick_y = 5 * h / 6;
			let joystick_radius = Math.min(w/16, h/16);
			let left_joystick_dx = 0, left_joystick_dy = 0, left_joystick_offset = 0;
			let right_joystick_dx = 0, right_joystick_dy = 0, right_joystick_offset = 0;;

			for(let i = 0; i < input.touch.length; i++) {
				if(input.touch[i].x < w / 2 && input.touch[i].y > h / 2) {
					left_joystick_dx = -left_joystick_x + input.touch[i].x;
					left_joystick_dy = -left_joystick_y + input.touch[i].y;
					left_joystick_offset = Math.sqrt(left_joystick_dx*left_joystick_dx + left_joystick_dy*left_joystick_dy);
					drawCircle(ctx, left_joystick_x, left_joystick_y , joystick_radius, 'gray', 'black');
					drawCircle(ctx, left_joystick_x + joystick_radius * left_joystick_dx / left_joystick_offset, left_joystick_y + joystick_radius * left_joystick_dy / left_joystick_offset, joystick_radius / 4, 'red', 'blue');
				}
				if(input.touch[i].x > w / 2 && input.touch[i].y > h / 2) {
					right_joystick_dx = -right_joystick_x + input.touch[i].x;
					right_joystick_dy = -right_joystick_y + input.touch[i].y;
					right_joystick_offset = Math.sqrt(right_joystick_dx*right_joystick_dx + right_joystick_dy*right_joystick_dy);
					drawCircle(ctx, right_joystick_x, right_joystick_y, joystick_radius, 'gray', 'black');
					drawCircle(ctx, right_joystick_x + joystick_radius * right_joystick_dx / right_joystick_offset, right_joystick_y + joystick_radius * right_joystick_dy / right_joystick_offset, joystick_radius / 4, 'purple', 'cyan');
				}
			}

			window.requestAnimationFrame(function() {
				animate(Date.now());
			});
		}

		function main() {
			ctx.imageSmoothingEnabled = false;
			initializeKeyboardInput(input.keys);
			initializeMouseInput(input.mouse, ctx);
			initializeTouchInput(input.touch, ctx);
			animate(Date.now());
		}

		main()
	</script>
</body>

</html>

