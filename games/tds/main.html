
<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
	<title>faw_tds</title>
	<link rel="icon" href="icon.png">
	<style>
		/* Убираем все отступы, чтобы игра занимала всё пространство без скролла */
		body {
			background-color: gray;
			margin: 0;
			padding: 0;
			height: 100vh;
			width: 100vw;
			display: flex;
			justify-content: center; /* Центрирование по горизонтали */
			align-items: center;     /* Центрирование по вертикали (для ПК) */
			overflow: hidden;
			touch-action: none;      /* Запрещает браузеру обрабатывать жесты (важно для игры) */
		}

		#canvas {
			background-color: #dddddd;
			border: 1px solid #aaaaaa;
			image-rendering: pixelated; /* Четкие пиксели */
			display: block;
			box-sizing: border-box;
		}
	</style>
</head>

<body>
	<canvas id="canvas" width="1000" height="1000"></canvas>

	<script type="text/javascript" src="player.js"></script>
	<script type="text/javascript" src="enemies.js"></script>
	<script type="text/javascript" src="bullets.js"></script>
	<script type="text/javascript" src="walls.js"></script>
	<script type="text/javascript" src="ammoboxes.js"></script>
	<script type="text/javascript" src="spawners.js"></script>
	<script type="text/javascript" src="collisions.js"></script>
	<script type="text/javascript" src="game.js"></script>
	<script type="text/javascript" src="menu.js"></script>
	<script type="text/javascript" src="input.js"></script>
	<script type="text/javascript" src="ammoboxZones.js"></script>
	<script type="text/javascript" src="healthkit.js"></script>
	<script type="text/javascript" src="healthkitZones.js"></script>

	<script>
		var bestScore = 0;
		var imgBackground = null;

		// Функция динамического изменения размера под экран
		function resizeCanvas() {
			const cvs = document.getElementById("canvas");
			const w = window.innerWidth;
			const h = window.innerHeight;

			// Вычисляем размер квадратной стороны
			const size = Math.min(w, h);

			// Устанавливаем размер CSS
			cvs.style.width = size + "px";
			cvs.style.height = size + "px";

			// Если экран вертикальный (телефон), прижимаем канвас к верху
			if (w < h) {
				document.body.style.alignItems = "flex-start";
			} else {
				document.body.style.alignItems = "center";
			}
		}

		window.addEventListener('resize', resizeCanvas);

		function setBackground(bg) {
			if (bg === 'city') {
				imgBackground = new Image();
				imgBackground.src = 'bg_city.png';
			}
		}

		function drawBackground(ctx) {
			if (imgBackground == null) return;
			// Рисуем на весь размер внутреннего разрешения
			ctx.drawImage(imgBackground, 0, 0, 1000, 1000);
		}

		function drawText(ctx, x, y, text) {
			ctx.font = "14px verdana";
			ctx.fillStyle = 'black';
			ctx.fillText(text, x, y);
			ctx.fillStyle = 'white';
			ctx.fillText(text, x + 1, y + 1);
		}

		function animate(g, ctx, input, lastUpdateTime) {
			// Вычисляем разницу во времени для плавности
			let dt = Date.now() - lastUpdateTime;
			updateGame(dt, g, input);
			lastUpdateTime = Date.now();
			
			if (g.player == null) {
				gameSetLevel(g, 1);
			} else {
				bestScore = Math.max(g.player.survivalTime, bestScore);
			}
			
			// Отрисовка
			ctx.clearRect(0, 0, 1000, 1000);
			drawBackground(ctx);
			drawGame(ctx, g, input);
			
			// Рисуем интерфейс и джойстики
			if (input.joystick) {
				drawJoysticks(ctx, input.joystick);
			}
			
			drawText(ctx, 15, 60, 'best survival time: ' + Math.round(bestScore / 1000.0));
			
			window.requestAnimationFrame(function() {
				animate(g, ctx, input, lastUpdateTime);
			});
		}

		function main() {
			let cvs = document.getElementById("canvas");
			let ctx = cvs.getContext("2d");

			// Настраиваем размер сразу
			resizeCanvas();

			let game1 = newGame(false);
			let input1 = getInput();
			
			gameSetLevel(game1, 1);
			setBackground('city');
			
			// Инициализация ввода с передачей чистого элемента canvas (cvs)
			initializeKeyboardInput(input1.keys);
			initializeMouseInput(input1.mouse, cvs);
			initializeTouchInput(input1.touch, input1.joystick, cvs);
			
			animate(game1, ctx, input1, Date.now());
		}

		// Запуск игры
		window.onload = main;

	</script>
</body>
</html>
